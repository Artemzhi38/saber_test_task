# saber_test_task

Веб-сервис для сортировки зависимостей билд-системы, реализованный на фреймворке Fast-api и использующий библиотеку networkx.

Сервис позволяет получать отсортированный список задач, необходимых для выполнения билда в порядке, в котором они могут быть выполнены,
учитывая зависимости выполнения одних задач от других. Исходные задачи для каждого билда описаны в файле 'builds.yaml'. Зависимости для
каждой из задач описаны в 'tasks.yaml'. Примеры файлов приведены в репозитории в директории '/builds'. По условию ТЗ циклические зависимости исключены.

Сортировка проводится с помощью библиотеки networkx, которая позволяет представить все описанные зависимости в виде ориентированного графа (DAG),
в котором узлами являются билды и задачи, а рёбрами - их зависимости друг от друга. Такая структура данных позволяет провести топологическую 
сортировку (алгоритм Кана). Из полученного в результате массива мы сохраняя порядок сортировки выделяем "предков" интересующего нас билда и получаем 
требуемый список задач.


## Запуск проекта 
Предварительно убеждаемся в том, что файлы с зависимостями для задач и билдов находятся в проекте. Имена файлов(без расширений), а также имя директории,
в которой они хранятся вынесено в файл переменных окружения '.env':
```bash
BUILDS_FOLDER_NAME = builds
BUILDS_FILE_NAME = builds
TASKS_FILE_NAME = tasks
```

Проект можно запустить в Docker с помощью команды:
```shell
docker-compose up -d --build    
```

Далее после билда образа и запуска заходим в Swagger по ссылке http://127.0.0.1:8000/docs и получаем возможность вручную протестировать работу эндпоинта:

### Получение списка зависимостей для билда
POST http://127.0.0.1:8000/get_tasks
Тело запроса: {"build_name": "build"}


## Тестирование проекта
Тестирование в проекте организовано с помощью библиотеки pytest. Юнит-тесты находятся в файле 'app_tests.py'.

Для их запуска из корневой директории проекта следует воспользоваться командой:
```shell
pytest app_tests.py   
```

Для тестов используется отдельный файл переменных окружения - '.test.env'


## Дополнительно

Код проекта был проверен линтерами black и isort
Зависимости указаны в файле requirements.txt
